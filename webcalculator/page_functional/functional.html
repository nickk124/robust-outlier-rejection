<!DOCTYPE html>
<html>
  <meta name="viewport" content="width=device-width, initial-scale=1"> <!--new-->
  <head>
      <script type="text/javascript">
  // These variables are used by the web2py_ajax_init function in web2py_ajax.js (which is loaded below).
        var w2p_ajax_confirm_message = "Are you sure you want to delete this object?";
        var w2p_ajax_date_format = "%Y-%m-%d";
        var w2p_ajax_datetime_format = "%Y-%m-%d %H:%M:%S";
  //--></script>
    <title>Functional RCR Calculator</title>
    <script src="/rcr/static/js/jquery.js" type="text/javascript"></script><link href="/rcr/static/css/calendar.css" rel="stylesheet" type="text/css" /><script src="/rcr/static/js/calendar.js" type="text/javascript"></script><script src="/rcr/static/js/web2py.js" type="text/javascript"></script><link href="/rcr/static/css/rcr2.css" rel="stylesheet" type="text/css" />
    <!--<link rel= "stylesheet" type= "text/css" href= "">-->
    <link href='https://fonts.googleapis.com/css?family=Josefin+Sans:300' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-1.3.4.min.css" type="text/css" />
    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.3.4.min.css" type="text/css" />

    <!--<script href= "" type="text/javascript"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-1.3.4.min.js"></script>
    <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.3.4.min.js"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>
  </head>
  <body>
<!--////////////////////////////////////////////////////////////////////////////-->
<!-- NAVIGATION BAR -->
<!--////////////////////////////////////////////////////////////////////////////-->
    <div id="wrap">
    <ul class="navbar">
            <li style="margin-left:50px;"><a href="/rcr/calculator">Home</a> </li>
            <li><a href="{{=URL(request.application, 'calculator', 'value')}}">Single-Value RCR Calculator</a></li>
            <li><a style="background-color:#5b8dd9;">Functional RCR Calculator</a></li>
            <li><a href="{{=URL(request.application, 'calculator', 'trk')}}">TRK Regression Calculator</a> </li>
            <li><a href="{{=URL(request.application, 'calculator', 'downloads')}}">Code and Downloads</a> </li>
            <li><a href="{{=URL(request.application, 'calculator', 'contact')}}">Contact Us</a> </li>
    </ul>
    </div>
<!--////////////////////////////////////////////////////////////////////////////-->
<!-- CALCULATOR -->
<!--////////////////////////////////////////////////////////////////////////////-->

<!--////////////////////////////////////////////////////////////////////////////-->
<!-- DATA INPUT SECTION -->
<!--////////////////////////////////////////////////////////////////////////////-->
    <div id="RMInput">
      <h1 style="font-size:3.5em;"> Functional RCR Calculator</h1>
            <br>

      <h1 style="font-size:2.5em;">Input Data</h1>
        <div id="StepOne">
            <div  id="ButtonSection">
                <h2> Select Data Type: </h2>
                <button id='Unweighted' class="Button DataType" onclick="noOutput()"> Equal Weights (Default) </button>
                <button id='Weighted' class="Button DataType" onclick="noOutput()"> Unequal Weights </button>
                <button id='ErrorBars' class="Button DataType" onclick="noOutput()"> Error Bars </button>
                <br>
                <br>

                <i style="padding-top:10px">Format: One data point per line: List the independent (x) values followed by the dependent (y) value, separated by white space. (In the case of multiple x values per data point, download and use the source code directly).</i>
                <br>
                <br>
                <i style="padding-top:10px">Weights, if unequal, should be included on the same line, separated by white space.</i>
                <br>
                <br>
                <i style="padding-top:10px">Alternatively, (symmetric, y) error bars may be entered instead of weights. These will be converted to weights using weight = 1/error<sup>2</sup>. However, if the scatter of the data is too large to be accounted for by the error bars alone, extrinsic scatter dominates and "Equal Weights" should be selected instead (&sect8.2.1, Maples et al. 2018).</i>
                <br>
                <br>
            </div>
            <div id="RejectionMethod" style="padding-top:25px;  position:relative; float:right">
                <textarea class="dataTable" id="inputTextAreaData" style="height:300px"></textarea>
            </div>
        </div>

      <h1 style="font-size:2.5em;">Plot Data</h1>
      <div id="StepOne">
        <br>
        <i style="padding-top:10px">Plot the data here, and zoom in (using the Box Zoom or Wheel Zoom tool) to the uncontaminated part of the distribution. Using the lower six buttons, you can change the basis of the data (in either or both x and y) such that the RMS scatter of average-weight data is approximately constant across the independent variable's domain, to be more compatible with RCR.</i>
        <br>
        <div id="Plot_input" style="padding:25px">
          <div class="bk-root" id="78f49d90-f30d-4e98-bc52-4029d85a112b" data-root-id="1059"></div>
            
          
        
      
      
        <script type="application/json" id="1141">
          {"aef3ac44-01e4-4dd5-9061-b58a89abe378":{"roots":{"references":[{"attributes":{"code":"\n    y_basis = \"exp\"\n    yaxislabel = '10^y'\n"},"id":"1043","type":"CustomJS"},{"attributes":{"code":"\n    x_basis = \"log\"\n    xaxislabel = 'log10(x)'\n"},"id":"1044","type":"CustomJS"},{"attributes":{"data_source":{"id":"1001","type":"ColumnDataSource"},"glyph":{"id":"1035","type":"Circle"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1036","type":"Circle"},"selection_glyph":null,"view":{"id":"1038","type":"CDSView"}},"id":"1037","type":"GlyphRenderer"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1021","type":"PanTool"},{"id":"1022","type":"WheelZoomTool"},{"id":"1023","type":"BoxZoomTool"},{"id":"1024","type":"SaveTool"},{"id":"1025","type":"ResetTool"},{"id":"1026","type":"HelpTool"}]},"id":"1027","type":"Toolbar"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1042","type":"CustomJS"},{"id":"1039","type":"CustomJS"}]},"label":"Exponential x Basis"},"id":"1049","type":"Button"},{"attributes":{"code":"\n    y_basis = \"log\"\n    yaxislabel = 'log10(y)'\n"},"id":"1045","type":"CustomJS"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1044","type":"CustomJS"},{"id":"1039","type":"CustomJS"}]},"label":"Logarithmic x Basis"},"id":"1048","type":"Button"},{"attributes":{"below":[{"id":"1011","type":"LinearAxis"}],"center":[{"id":"1015","type":"Grid"},{"id":"1020","type":"Grid"}],"left":[{"id":"1016","type":"LinearAxis"}],"plot_height":400,"renderers":[{"id":"1037","type":"GlyphRenderer"}],"title":{"id":"1061","type":"Title"},"toolbar":{"id":"1027","type":"Toolbar"},"x_range":{"id":"1003","type":"DataRange1d"},"x_scale":{"id":"1007","type":"LinearScale"},"y_range":{"id":"1005","type":"DataRange1d"},"y_scale":{"id":"1009","type":"LinearScale"}},"id":"1002","subtype":"Figure","type":"Plot"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1039","type":"CustomJS"}]},"label":"Plot Data"},"id":"1046","type":"Button"},{"attributes":{},"id":"1021","type":"PanTool"},{"attributes":{"text":""},"id":"1061","type":"Title"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1040","type":"CustomJS"},{"id":"1039","type":"CustomJS"}]},"label":"Linear x Basis"},"id":"1047","type":"Button"},{"attributes":{},"id":"1022","type":"WheelZoomTool"},{"attributes":{"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"size":{"units":"screen","value":5},"x":{"field":"x"},"y":{"field":"y"}},"id":"1036","type":"Circle"},{"attributes":{},"id":"1062","type":"BasicTickFormatter"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1041","type":"CustomJS"},{"id":"1039","type":"CustomJS"}]},"label":"Linear y Basis"},"id":"1050","type":"Button"},{"attributes":{"overlay":{"id":"1068","type":"BoxAnnotation"}},"id":"1023","type":"BoxZoomTool"},{"attributes":{},"id":"1066","type":"UnionRenderers"},{"attributes":{},"id":"1009","type":"LinearScale"},{"attributes":{"dimension":1,"ticker":{"id":"1017","type":"BasicTicker"}},"id":"1020","type":"Grid"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1045","type":"CustomJS"},{"id":"1039","type":"CustomJS"}]},"label":"Logarithmic y Basis"},"id":"1051","type":"Button"},{"attributes":{"fill_alpha":{"value":0.5},"fill_color":{"value":"navy"},"line_alpha":{"value":0.5},"line_color":{"value":"navy"},"size":{"units":"screen","value":5},"x":{"field":"x"},"y":{"field":"y"}},"id":"1035","type":"Circle"},{"attributes":{},"id":"1024","type":"SaveTool"},{"attributes":{"children":[{"id":"1057","type":"Row"},{"id":"1058","type":"Column"}]},"id":"1059","type":"Column"},{"attributes":{},"id":"1017","type":"BasicTicker"},{"attributes":{"code":"\n    x_basis = \"exp\"\n    xaxislabel = '10^x'\n"},"id":"1042","type":"CustomJS"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1043","type":"CustomJS"},{"id":"1039","type":"CustomJS"}]},"label":"Exponential y Basis"},"id":"1052","type":"Button"},{"attributes":{},"id":"1025","type":"ResetTool"},{"attributes":{},"id":"1064","type":"BasicTickFormatter"},{"attributes":{"callback":null,"data":{"x":[],"y":[]},"selected":{"id":"1067","type":"Selection"},"selection_policy":{"id":"1066","type":"UnionRenderers"}},"id":"1001","type":"ColumnDataSource"},{"attributes":{},"id":"1067","type":"Selection"},{"attributes":{"children":[{"id":"1050","type":"Button"},{"id":"1051","type":"Button"},{"id":"1052","type":"Button"}]},"id":"1055","type":"Row"},{"attributes":{"children":[{"id":"1047","type":"Button"},{"id":"1048","type":"Button"},{"id":"1049","type":"Button"}]},"id":"1054","type":"Row"},{"attributes":{},"id":"1007","type":"LinearScale"},{"attributes":{},"id":"1026","type":"HelpTool"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1068","type":"BoxAnnotation"},{"attributes":{"children":[{"id":"1046","type":"Button"}]},"id":"1053","type":"WidgetBox"},{"attributes":{"args":{"p":{"id":"1002","subtype":"Figure","type":"Plot"},"src":{"id":"1001","type":"ColumnDataSource"},"xaxis":{"id":"1011","type":"LinearAxis"},"yaxis":{"id":"1016","type":"LinearAxis"}},"code":"\n    p.reset.emit();\n\n    var input_data = getData(); //getData also transforms\n    var x_data = input_data[0];\n    var y_data = input_data[1];\n\n    var data = src.data;\n\n    var x = [];\n    var y = [];\n\n    x = data['x'];\n    y = data['y'];\n\n    if (x_data.length != y_data.length){\n        testLog('Alert: inputted data must be same size');\n    }\n\n    for (var i = 0; i &lt; y_data.length; i++){\n        x[i] = x_data[i];\n        y[i] = y_data[i];\n    }\n\n    x = x.slice(0,y_data.length);\n    y = y.slice(0,y_data.length);\n\n    data['x'] = x;\n    data['y'] = y;\n\n    xaxis.axis_label = xaxislabel;\n    yaxis.axis_label = yaxislabel;\n\n    p.change.emit();\n    src.change.emit();\n"},"id":"1039","type":"CustomJS"},{"attributes":{"callback":null},"id":"1003","type":"DataRange1d"},{"attributes":{"height":70,"text":"\n&lt;br&gt;\n&lt;h1 style=\"font-size:2.5em;\"&gt;Select the Basis of the Dependent Variable&lt;/h1&gt;\n","width":800},"id":"1056","type":"Div"},{"attributes":{"axis_label":"y(x)","formatter":{"id":"1064","type":"BasicTickFormatter"},"ticker":{"id":"1017","type":"BasicTicker"}},"id":"1016","type":"LinearAxis"},{"attributes":{"code":"\n    y_basis = \"linear\"\n    yaxislabel = 'y'\n"},"id":"1041","type":"CustomJS"},{"attributes":{"axis_label":"x","formatter":{"id":"1062","type":"BasicTickFormatter"},"ticker":{"id":"1012","type":"BasicTicker"}},"id":"1011","type":"LinearAxis"},{"attributes":{"ticker":{"id":"1012","type":"BasicTicker"}},"id":"1015","type":"Grid"},{"attributes":{"source":{"id":"1001","type":"ColumnDataSource"}},"id":"1038","type":"CDSView"},{"attributes":{"children":[{"id":"1002","subtype":"Figure","type":"Plot"},{"id":"1053","type":"WidgetBox"}]},"id":"1057","type":"Row"},{"attributes":{"code":"\n    x_basis = \"linear\"\n    xaxislabel = 'x'\n"},"id":"1040","type":"CustomJS"},{"attributes":{"children":[{"id":"1056","type":"Div"},{"id":"1054","type":"Row"},{"id":"1055","type":"Row"}]},"id":"1058","type":"Column"},{"attributes":{"callback":null},"id":"1005","type":"DataRange1d"},{"attributes":{},"id":"1012","type":"BasicTicker"}],"root_ids":["1059"]},"title":"Bokeh Application","version":"1.3.4"}}
        </script>
        <script type="text/javascript">
          (function() {
            var fn = function() {
              Bokeh.safely(function() {
                (function(root) {
                  function embed_document(root) {
                    
                  var docs_json = document.getElementById('1141').textContent;
                  var render_items = [{"docid":"aef3ac44-01e4-4dd5-9061-b58a89abe378","roots":{"1059":"78f49d90-f30d-4e98-bc52-4029d85a112b"}}];
                  root.Bokeh.embed.embed_items(docs_json, render_items);
                
                  }
                  if (root.Bokeh !== undefined) {
                    embed_document(root);
                  } else {
                    var attempts = 0;
                    var timer = setInterval(function(root) {
                      if (root.Bokeh !== undefined) {
                        embed_document(root);
                        clearInterval(timer);
                      }
                      attempts++;
                      if (attempts > 100) {
                        console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                        clearInterval(timer);
                      }
                    }, 10, root)
                  }
                })(window);
              });
            };
            if (document.readyState != "loading") fn();
            else document.addEventListener("DOMContentLoaded", fn);
          })();
        </script>
        </div>

        <!-- <i style="padding-top:10px">The basis options are linear (default, y → y), logarithmic (y → log(y), base 10), and exponential (y → 10<sup> y</sup>).</i> -->
      </div>

      <h1 style="font-size:2.5em;">Model Data</h1>
      <div id="StepOne" style="overflow:visible">
        <div>
          <div id="ButtonSection" style="float:left; width:30%">
            <h2 id="ModelTitle">Model y(x):</h2>
            <div>
              <div class="dropdown">
                <button id="SelectedFunction" class="dropbtn">(Select Function Here)</button>
                <div class="dropdown-content" style="width:180%; overflow:visible;">
                  <button id="Linear" class="Button Function" onclick="displayChosenFunction(this); displayBar(this);">y(x) = a<sub>0</sub> + a<sub>1</sub>(x-<span style="text-decoration:overline">x</span>)</button>
                  <br>
                  <button id="Quadratic" class="Button Function" onclick="displayChosenFunction(this); displayBar(this);">y(x) = a<sub>0</sub> + a<sub>1</sub>(x-<span style="text-decoration:overline">x</span>) + a<sub>2</sub>(x-<span style="text-decoration:overline">x</span>)<sup>2</sup></button>
                  <br>
                  <button id="Cubic" class="Button Function" onclick="displayChosenFunction(this); displayBar(this);">y(x) = a<sub>0</sub> + a<sub>1</sub>(x-<span style="text-decoration:overline">x</span>) + a<sub>2</sub>(x-<span style="text-decoration:overline">x</span>)<sup>2</sup> + a<sub>3</sub>(x-<span style="text-decoration:overline">x</span>)<sup>3</sup></button>
                  <br>
                  <button id="PowerLaw" class="Button Function" onclick="displayChosenFunction(this); displayBar(this);">y(x) = a<sub>0</sub>(x/10<sup><span style="text-decoration:overline">log x</span></sup>)<sup>a<sub>1</sub></sup></button>
                  <br>
                  <button id="Exponential" class="Button Function" onclick="displayChosenFunction(this); displayBar(this);">y(x) = a<sub>0</sub>10<sup>a<sub>1</sub>(x-<span style="text-decoration:overline">x</span>)</sup></button>
                  <br>
                  <button id="Logarithmic" class="Button Function" onclick="displayChosenFunction(this); displayBar(this);">y(x) = a<sub>0</sub>log(x/10<sup><span style="text-decoration:overline">log x</span></sup> )</button>
                </div>
              </div>
              <br>
              <br>
              <i style="padding-top:10px">Here, select a function to model y(x), log y(x) or 10<sup> y</sup>, depending on your chosen basis for y(x) in the above section. Depending on the chosen function, either <span style="text-decoration:overline">x</span> or <span style="text-decoration:overline">log x</span> will be displayed from the inputted data, depending on which model function is selected. </i>
              <br>
              <br>
              <i style="padding-top:10px">Next, in the box to the right, enter your guess for the model function parameters a<sub>0</sub> , a<sub>1</sub> , a<sub>2</sub> , etc, one per line. For example, in the linear model case, a<sub>0</sub> corresponds to the y-intercept, and a<sub>1</sub> to the slope. </i>
              <br>
              <br>
              <i style="padding-top:10px">For large datasets and/or for non-listed custom functions, <br>it is recommended to just download the C++ source code (documentation included) <a href="/rcr/calculator/downloads">here</a>.</i>
              <br>
              <br>
            </div>
          </div>
          <div style="float:left; width:30%; padding:5px;">
            <h2>Suggested form of initial guess for <span id="xBarType" style="text-decoration:overline">x</span>:</h2>
            <h3 id="XBarDisplay"><span style="text-decoration:overline">x</span> = Σ<sub>i</sub>w<sub>i</sub>x<sub>i</sub> / Σ<sub>i</sub>w<sub>i</sub></h3>
            <br>
            <h2>Input Initial Guess for <span id="xBarInp" style="text-decoration:overline">x</span>:</h2>
            <textarea class="dataTable" id="barArea" style="height:20px; width:70%;float: left;"></textarea>

          </div>
          <div id="RejectionMethod" style="float:left; width:30%">
            <h2>Input Initial Guess for Model Function Parameters:</h2>
            <br>
            <textarea class="dataTable" id="guessarea" style="height:300px"></textarea>
          </div>
          <br style="clear: left;" />
        </div>
        <br>
        <div><!-- style="position:relative; display:block;"> -->
          <h2>Model Bayesian Prior Distributions of Model Function Parameters (Optional):</h2>
          <div style="width:45%; float:left; padding:5px;">
            <div id="ButtonSection">
              <button id='NoPriors' class="Button Priors" onclick="showPriorsBox(false);"> No (default) </button>
              <button id='YesPriors' class="Button Priors" onclick="showPriorsBox(true);"> Yes </button>
            </div>
            <div id="priorsBox">
              <div style="padding-top:10px; padding-bottom:20px; width:80%;">
                <i>If you have some prior knowledge of the distribution(s) of your model function's parameters, this is where you can implement it.</i>
                <br>
                <br>
                <i style="padding-top:10px">Format: One model parameter per line. For each line, list the lower bound for the parameter (or an "x" if there is none), followed by the upper bound (or an "x" if there is none), followed by the mean and the standard deviation of the Gaussian (or two "x"s in their place if the prior is flat), all seperated by white space.</i>
                <br>
                <br>
                <i style="padding-top:10px">In total, each line will have four elements (either numbers or "x"s if no prior provided) seperated by white space. For example, a prior with lower bound of 0, no upper bound, and a Gaussian with μ = 1, σ = 2 would have a line of "0 x 1 2".</i>
                <br>
                <br>
                <i>For custom priors, use the source code (with documentation included).</i>
              </div>
              <div style="width:80%">
                <img src="/rcr/static/priorspic.png">
              </div>
              <div style="padding-top:10px; padding-bottom:20px; width:80%;">
                <i>Pictured is a Gaussian prior distribution with μ = 1, σ = 2, and an upper bound of 3.</i>
              </div>
            </div>
          </div>
          <div id="priorsInput" style="padding:5px; width:45%; float:left;">
            <h2>Input Priors:</h2>
            <textarea class="dataTable" id="priorsArea" style="height:300px"></textarea>
          </div>
        </div>
      </div>
      <br>
      <div style="clear:both"></div>
			<h1 style="font-size:2.5em; padding-top:25px;"> Select Rejection Method </h1>
<!--////////////////////////////////////////////////////////////////////////////-->
<!-- DISTRIBUTION SELECTION -->
<!--////////////////////////////////////////////////////////////////////////////-->
			<div id="StepOne" style="overflow:auto">

                <div id="ButtonSection">

                    <h2> Select Uncontaminated Distribution about y(x):</h2>

                    <button id="Symmetric" class="Button Distribution"> Gaussian, Mildly Peaked, or Mildly Flat-Topped (Default) </button>
                    <button id="Asymmetric" class="Button Distribution"> Mildly Asymmetric (Less Powerful) </button>

                    <h2 id="SelectContaminantSectionTitle"> Select Contaminant Type:</h2>
		    <div id="SelectContaminantSection">
                    	<button id="Equal" class="Button Contaminants"> High and Low in Equal Proportions </button>
                    	<button id="OneSided" class="Button Contaminants"> All High or All Low </button>
                    	<button id="Between" class="Button Contaminants"> In Between (Default) </button>
                    </div>
		            </div>
                <div id="RejectionMethod">

                    <h2> Selected Uncontaminated Distribution about y(x): </h2>
			<br>
      <div style="width:80%">
        <img src="/rcr/static/rcr1.png" id="SymmetricImage">
  			<img src="/rcr/static/rcr2.png" id="AsymmetricImage">
      </div>
                    <h2> Selected Rejection Method: </h2>
                    <p id="Option11" class="RejectionMethods">
                         μ: Median (§2.1; Maples et al. 2018) <br>
                         σ : Broken-line technique (§2.2, §2.3) <br>
                        Rejection proportional to σ both below and above  μ (§3.1, §3.3.2)
                    </p>
                    <p id="Option12" class="RejectionMethods">
												μ : Half-sample mode (§2.1; Maples et al. 2018)  <br>
												σ<sub>-</sub> , σ<sub>+</sub> : 68.3%-Value technique (§2.2, §2.3)<br>
                        Rejection proportional to min{σ<sub>-</sub> , σ<sub>+</sub>} both below and above μ (§3.2, §3.3.2)
                    </p>
                    <p id="Option13" class="RejectionMethods">
												μ: Half-sample mode (§2.1; Maples et al. 2018)  <br>
                        σ<sub>-</sub> , σ<sub>+</sub> : Broken-line technique (§2.2, §2.3)<br>
                        Rejection proportional to min{σ<sub>-</sub> , σ<sub>+</sub>} both below and above μ (§3.2, §3.3.2)
                    </p>
                    <p id="Option2All" class="RejectionMethods">
												μ: Half-sample mode (§2.1; Maples et al. 2018)  <br>
                        σ<sub>-</sub> , σ<sub>+</sub> : Broken-line technique (§2.2, §2.3)<br>
                        Rejection proportional to σ<sub>-</sub> below μ and σ<sub>+</sub> above μ (§3.3.1)
                    </p>
                    <p id="Option3" class="RejectionMethods">
			Fundamentally, RCR assumes that the uncontaminated distribution is Gaussian, or near Gaussian.  In particular, our <q>All High or All Low</q> and <q>In Between</q> contaminant type options are especially sensitive to this assumption, and should not be used if this assumption is not met.                    </p>
                    <p id="OptionAll" class="RejectionMethods">
                        Note: Rejection method is iterative, preceded by iterative bulk rejection (§5), and proceeded by both (1) iterative "median + 68.3%-value technique" rejection, and (2) iterative "mean + standard deviation " rejection (§4).
                    </p>

                </div>
            </div>

<!--////////////////////////////////////////////////////////////////////////////-->
<!-- DATA OUTPUT SECTION -->
<!--////////////////////////////////////////////////////////////////////////////-->

            <h1 style="font-size:2.5em; padding-top:25px;"> Output </h1>
              <div id="StepOne">
                <h1 id="BasisNotice" style="font-size:2.5em; padding-top:25px;">Note: results are in the chosen linear basis.</h1>
                <div  id="ButtonSection" style="float:left; width:46%; padding-right:25px">
                <br>
                    <div  style="float:left; width:400px">
                        <button id="PerformRCR" class="Button RejectButton"  onclick="performFunctionalRCR();">Perform RCR!</button>
                    </div>
                    <br>
                    <div id="OutputTableWrapper">
                        <div id="ButtonSection" style="width:100%; padding:5px 0px 5px 0px;">
                        <br>
                            <table style="width:100%;">
                            <tr>
                                <td  style="width:33%;">
                                    <button id="showNonRejected" class="Button DataType"> Show Unrejected Points </button>
                                </td>
                                <td  style="width:33%;">
                                    <button id="showRejected" class="Button DataType"> Show Rejected Points </button>
                                </td>
                                <td  style="width:33%;">
                                    <button id="showAll" class="Button DataType"> Show Both With Flags </button>
                                </td>
                            </tr>
                            </table>
                        </div>

                        <div id="RejectionMethod" style="width:130%; float:right">
                          <table style="float:right">
                            <tr>
                              <th>Final model<br>parameters (and pivot point):</th>
                              <th style="width:400px">Selected Points (x, y):</th>
                            </tr>
                            <tr>
                              <th><textarea class="dataTable" id="finalParameters" style="margin-top:10px; width:80%; height:200px"></textarea></th>
                              <th style="width:400px">
                                <textarea class="dataTable" id="nonRejectedData" style="margin-top:10px; width:80%; height:200px"></textarea>
                                <textarea class="dataTable" id="rejectedData" style="margin-top:10px; width:80%; height:200px"></textarea>
                                <textarea class="dataTable" id="allData" style="margin-top:15px; width:80%; height:200px"></textarea>
                              </th>
                            </tr style="padding-bottom:10px">
                            <!--
                            <tr style="padding-top:10px">
                              <th>Final <span id="xBarOut" style="text-decoration:overline">x</span>:</th>
                            </tr>
                            <tr>
                              <th><textarea class="dataTable" id="finalBar" style="margin-top:10px; width:80%; height:200px"></textarea></th>
                            </tr>
                          -->
                          </table>
                        </div>
                    </div>
                    <div id="NonRCRNote">
                        <i style="padding-top:10px; display:block;">Note:  RCR not performed.</i>

                    </div>
										<div id="OverRejectionNote">
                        <i id="OverRejectionNotice" style="padding-top:10px; display:block;"></i>

                    </div>
                </div>
                <!-- PLOT DIV -->
                <div id="Plot" style="float:left; width:46%">
                  <div class="bk-root" id="2490b539-ed78-4486-845d-1693a782d25c" data-root-id="1084"></div>
            
          
        
      
      
        <script type="application/json" id="1202">
          {"13dedbfb-31a2-44bc-817c-7e8eb23b0f1d":{"roots":{"references":[{"attributes":{"fill_alpha":{"value":0.5},"fill_color":{"value":"navy"},"line_alpha":{"value":0.5},"line_color":{"value":"navy"},"size":{"units":"screen","value":5},"x":{"field":"x_nonrejected"},"y":{"field":"y_nonrejected"}},"id":"1037","type":"Circle"},{"attributes":{"axis_label":"y","formatter":{"id":"1043","type":"BasicTickFormatter"},"ticker":{"id":"1019","type":"BasicTicker"}},"id":"1018","type":"LinearAxis"},{"attributes":{"callback":null,"data":{"x_nonrejected":[],"y_nonrejected":[]},"selected":{"id":"1062","type":"Selection"},"selection_policy":{"id":"1063","type":"UnionRenderers"}},"id":"1001","type":"ColumnDataSource"},{"attributes":{"line_color":"green","line_width":2,"x":{"field":"x_original"},"y":{"field":"y_fitted"}},"id":"1066","type":"Line"},{"attributes":{"below":[{"id":"1013","type":"LinearAxis"}],"center":[{"id":"1017","type":"Grid"},{"id":"1022","type":"Grid"},{"id":"1048","type":"Legend"}],"left":[{"id":"1018","type":"LinearAxis"}],"renderers":[{"id":"1039","type":"GlyphRenderer"},{"id":"1053","type":"GlyphRenderer"},{"id":"1068","type":"GlyphRenderer"}],"title":{"id":"1041","type":"Title"},"toolbar":{"id":"1029","type":"Toolbar"},"x_range":{"id":"1005","type":"DataRange1d"},"x_scale":{"id":"1009","type":"LinearScale"},"y_range":{"id":"1007","type":"DataRange1d"},"y_scale":{"id":"1011","type":"LinearScale"}},"id":"1004","subtype":"Figure","type":"Plot"},{"attributes":{"callback":null},"id":"1005","type":"DataRange1d"},{"attributes":{"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"size":{"units":"screen","value":5},"x":{"field":"x_rejected"},"y":{"field":"y_rejected"}},"id":"1052","type":"Circle"},{"attributes":{"callback":null,"data":{"x_rejected":[],"y_rejected":[]},"selected":{"id":"1079","type":"Selection"},"selection_policy":{"id":"1080","type":"UnionRenderers"}},"id":"1002","type":"ColumnDataSource"},{"attributes":{"label":{"value":"rejected data"},"renderers":[{"id":"1053","type":"GlyphRenderer"}]},"id":"1064","type":"LegendItem"},{"attributes":{"data_source":{"id":"1002","type":"ColumnDataSource"},"glyph":{"id":"1051","type":"Circle"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1052","type":"Circle"},"selection_glyph":null,"view":{"id":"1054","type":"CDSView"}},"id":"1053","type":"GlyphRenderer"},{"attributes":{"text":""},"id":"1041","type":"Title"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1023","type":"PanTool"},{"id":"1024","type":"WheelZoomTool"},{"id":"1025","type":"BoxZoomTool"},{"id":"1026","type":"SaveTool"},{"id":"1027","type":"ResetTool"},{"id":"1028","type":"HelpTool"}]},"id":"1029","type":"Toolbar"},{"attributes":{},"id":"1009","type":"LinearScale"},{"attributes":{},"id":"1023","type":"PanTool"},{"attributes":{"source":{"id":"1002","type":"ColumnDataSource"}},"id":"1054","type":"CDSView"},{"attributes":{},"id":"1062","type":"Selection"},{"attributes":{},"id":"1024","type":"WheelZoomTool"},{"attributes":{},"id":"1095","type":"Selection"},{"attributes":{"ticker":{"id":"1014","type":"BasicTicker"}},"id":"1017","type":"Grid"},{"attributes":{"overlay":{"id":"1047","type":"BoxAnnotation"}},"id":"1025","type":"BoxZoomTool"},{"attributes":{"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"size":{"units":"screen","value":5},"x":{"field":"x_nonrejected"},"y":{"field":"y_nonrejected"}},"id":"1038","type":"Circle"},{"attributes":{},"id":"1063","type":"UnionRenderers"},{"attributes":{},"id":"1096","type":"UnionRenderers"},{"attributes":{},"id":"1026","type":"SaveTool"},{"attributes":{"fill_alpha":{"value":0.5},"fill_color":{"value":"red"},"line_alpha":{"value":0.5},"line_color":{"value":"red"},"size":{"units":"screen","value":5},"x":{"field":"x_rejected"},"y":{"field":"y_rejected"}},"id":"1051","type":"Circle"},{"attributes":{"source":{"id":"1001","type":"ColumnDataSource"}},"id":"1040","type":"CDSView"},{"attributes":{"data_source":{"id":"1001","type":"ColumnDataSource"},"glyph":{"id":"1037","type":"Circle"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1038","type":"Circle"},"selection_glyph":null,"view":{"id":"1040","type":"CDSView"}},"id":"1039","type":"GlyphRenderer"},{"attributes":{},"id":"1019","type":"BasicTicker"},{"attributes":{},"id":"1027","type":"ResetTool"},{"attributes":{"items":[{"id":"1049","type":"LegendItem"},{"id":"1064","type":"LegendItem"},{"id":"1081","type":"LegendItem"}]},"id":"1048","type":"Legend"},{"attributes":{"line_alpha":0.1,"line_color":"#1f77b4","line_width":2,"x":{"field":"x_original"},"y":{"field":"y_fitted"}},"id":"1067","type":"Line"},{"attributes":{"data_source":{"id":"1003","type":"ColumnDataSource"},"glyph":{"id":"1066","type":"Line"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1067","type":"Line"},"selection_glyph":null,"view":{"id":"1069","type":"CDSView"}},"id":"1068","type":"GlyphRenderer"},{"attributes":{},"id":"1028","type":"HelpTool"},{"attributes":{"children":[{"id":"1083","type":"Button"},{"id":"1004","subtype":"Figure","type":"Plot"}]},"id":"1084","type":"Column"},{"attributes":{"dimension":1,"ticker":{"id":"1019","type":"BasicTicker"}},"id":"1022","type":"Grid"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1082","type":"CustomJS"}]},"label":"Plot Results"},"id":"1083","type":"Button"},{"attributes":{"axis_label":"x","formatter":{"id":"1045","type":"BasicTickFormatter"},"ticker":{"id":"1014","type":"BasicTicker"}},"id":"1013","type":"LinearAxis"},{"attributes":{"label":{"value":"nonrejected data of size"},"renderers":[{"id":"1039","type":"GlyphRenderer"}]},"id":"1049","type":"LegendItem"},{"attributes":{"source":{"id":"1003","type":"ColumnDataSource"}},"id":"1069","type":"CDSView"},{"attributes":{},"id":"1014","type":"BasicTicker"},{"attributes":{},"id":"1079","type":"Selection"},{"attributes":{"callback":null},"id":"1007","type":"DataRange1d"},{"attributes":{"callback":null,"data":{"x_original":[],"y_fitted":[]},"selected":{"id":"1095","type":"Selection"},"selection_policy":{"id":"1096","type":"UnionRenderers"}},"id":"1003","type":"ColumnDataSource"},{"attributes":{"label":{"value":"fitted model"},"renderers":[{"id":"1068","type":"GlyphRenderer"}]},"id":"1081","type":"LegendItem"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1047","type":"BoxAnnotation"},{"attributes":{},"id":"1011","type":"LinearScale"},{"attributes":{},"id":"1080","type":"UnionRenderers"},{"attributes":{"args":{"p":{"id":"1004","subtype":"Figure","type":"Plot"},"sourceall":{"id":"1003","type":"ColumnDataSource"},"sourcenon":{"id":"1001","type":"ColumnDataSource"},"sourcerej":{"id":"1002","type":"ColumnDataSource"}},"code":"\n    console.log('Plot Generating...');\n\n    p.reset.emit();\n\n    var datanon = sourcenon.data;\n    var datarej = sourcerej.data;\n    var dataall = sourceall.data;\n\n    var x_rejected = datarej['x_rejected']\n    var y_rejected = datarej['y_rejected']\n    var x_nonrejected = datanon['x_nonrejected']\n    var y_nonrejected = datanon['y_nonrejected']\n    var x_original = dataall['x_original']\n    var y_fitted = dataall['y_fitted']\n\n    for (var i = 0; i &lt; x_rejected_result.length; i++) {\n        x_rejected[i] = x_rejected_result[i]\n        y_rejected[i] = y_rejected_result[i]\n    }\n    for (var i = 0; i &lt; x_nonrejected_result.length; i++) {\n        x_nonrejected[i] = x_nonrejected_result[i]\n        y_nonrejected[i] = y_nonrejected_result[i]\n    }\n\n    x_original = [];\n    y_fitted = [];\n\n    console.log(x_original_result.length);\n\n    for (var i = 0; i &lt; x_original_result.length; i++) {\n        x_original.push(x_original_result[i]);\n        y_fitted.push(y_fitted_result[i]);\n    }\n\n    datarej['x_rejected'] = x_rejected;\n    datarej['y_rejected'] = y_rejected;\n    datanon['x_nonrejected'] = x_nonrejected;\n    datanon['y_nonrejected'] = y_nonrejected;\n    dataall['x_original'] = x_original;\n    dataall['y_fitted'] = y_fitted;\n\n    console.log(dataall['x_original']);\n    console.log(dataall['y_fitted']);\n\n    sourcenon.change.emit();\n    sourcerej.change.emit();\n    sourceall.change.emit();\n    p.change.emit();\n"},"id":"1082","type":"CustomJS"},{"attributes":{},"id":"1043","type":"BasicTickFormatter"},{"attributes":{},"id":"1045","type":"BasicTickFormatter"}],"root_ids":["1084"]},"title":"Bokeh Application","version":"1.3.4"}}
        </script>
        <script type="text/javascript">
          (function() {
            var fn = function() {
              Bokeh.safely(function() {
                (function(root) {
                  function embed_document(root) {
                    
                  var docs_json = document.getElementById('1202').textContent;
                  var render_items = [{"docid":"13dedbfb-31a2-44bc-817c-7e8eb23b0f1d","roots":{"1084":"2490b539-ed78-4486-845d-1693a782d25c"}}];
                  root.Bokeh.embed.embed_items(docs_json, render_items);
                
                  }
                  if (root.Bokeh !== undefined) {
                    embed_document(root);
                  } else {
                    var attempts = 0;
                    var timer = setInterval(function(root) {
                      if (root.Bokeh !== undefined) {
                        embed_document(root);
                        clearInterval(timer);
                      }
                      attempts++;
                      if (attempts > 100) {
                        console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                        clearInterval(timer);
                      }
                    }, 10, root)
                  }
                })(window);
              });
            };
            if (document.readyState != "loading") fn();
            else document.addEventListener("DOMContentLoaded", fn);
          })();
        </script>
                </div>
              </div>
              <div style="clear:both"></div>

            </div>

          <br>

  </body>
</html>
<script>
var chosenFunctionType;

//Initializing the final result lists that will come from RCR and will result in plotting:
var x_rejected_result = [];
var y_rejected_result = [];
var x_nonrejected_result = [];
var y_nonrejected_result = [];
var x_original_result = [];
var y_fitted_result = [];

var x_basis = 'linear';
var y_basis = 'linear';

var xaxislabel = 'x'
var yaxislabel = 'y'

var x_data_range = 0;
// MODEL FUNCTIONS
//
//
function linear(x, params, bar){
  var a0 = params[0];
	var a1 = params[1];

	return a0 + a1 * (x - bar);
}

function quadratic(x, params, bar){
  var a0 = params[0];
	var a1 = params[1];
  var a2 = params[2];

	return a0 + a1 * (x - bar) + a2 * Math.pow((x - bar), 2.0);
}

function cubic(x, params, bar){
  var a0 = params[0];
	var a1 = params[1];
  var a2 = params[2];
  var a3 = params[3];

	return a0 + a1 * (x - bar) + a2 * Math.pow((x - bar), 2.0) + a3 * Math.pow((x - bar), 3.0);
}

function powerlaw(x, params, bar){
  var a0 = params[0];
	var a1 = params[1];

	return a0 * Math.pow((x / Math.pow(10, bar)), a1);
}

function exponential(x, params, bar){
  var a0 = params[0];
	var a1 = params[1];

	return a0 * Math.pow(10, a1*(x - bar));
}

function logarithmic(x, params, bar){
  var a0 = params[0];

	return a0 * Math.log10(x - bar);
}
//
//
//
function noOutput(){
	$('#OutputTableWrapper').css('display', 'none');
	$('#OverRejectionNote').css('display', 'none');
}

function test(){
  console.log('Testing performFunctionalRCR button')
  return;
}

function testCallBegin(){
	console.log('Callback begins');
	return;
}

function testCallEnd(){
	console.log('Callback ends');
	return;
}

function testLog(thing){
	console.log(thing);
	return;
}

function changeFunctionDisplay(oldy_basis){
  var buttonNames = document.getElementsByClassName('Button DataType Function');
  switch (oldy_basis){
    case 'linear':
      switch (y_basis){
        case 'linear':
          break;
        case 'log':
          for (var i = 0; i < buttonNames.length; i++){
            var newName = "log y(x) = ";
            newName += buttonNames[i].innerHTML.slice(7, -1);
            buttonNames[i].innerHTML = newName;
          }
          break;
        case 'exp':
          for (var i = 0; i < buttonNames.length; i++){
            var newName = "10<sup>y(x)</sup> = ";
            newName += buttonNames[i].innerHTML.slice(7, -1);
            buttonNames[i].innerHTML = newName;
          }
          break;
        default:
          break;
      }
      break;
    case 'log':
      switch (y_basis){
        case 'linear':
          for (var i = 0; i < buttonNames.length; i++){
            var newName = "y(x) = ";
            newName += buttonNames[i].innerHTML.slice(11, -1);
            buttonNames[i].innerHTML = newName;
          }
          break;
        case 'log':
          break;
        case 'exp':
          for (var i = 0; i < buttonNames.length; i++){
            var newName = "10<sup>y(x)</sup> = ";
            newName += buttonNames[i].innerHTML.slice(11, -1);
            buttonNames[i].innerHTML = newName;
          }
          break;
        default:
          break;
      }
      break;
    case 'exp':
      switch (y_basis){
        case 'linear':
          for (var i = 0; i < buttonNames.length; i++){
            var newName = "y(x) = ";
            newName += buttonNames[i].innerHTML.slice(20, -1);
            buttonNames[i].innerHTML = newName;
          }
          break;
        case 'log':
          for (var i = 0; i < buttonNames.length; i++){
            var newName = "log y(x) = ";
            newName += buttonNames[i].innerHTML.slice(20, -1);
            buttonNames[i].innerHTML = newName;
          }
          break;
        case 'exp':
          break;
        default:
          break;
      }
      break;
    default:
      break;
  }
}

function transformXLinear(x_data, y_data){ //takes in RAW DATA for x and y, always
	var trans_x = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
  var new_y = [];

	for (var i = 0; i < x_data.length; i++){
		if (x_data[i] > 0){
			trans_x.push(x_data[i]);
      switch (y_basis){
        case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
          new_y.push(y_data[i]);
          break;
        case 'log':
          if (y_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
            trans_x.pop();
          } else {
            new_y.push(Math.log10(y_data[i]));
          }
        case 'exp':
          new_y.push(Math.pow(10,y_data[i]));
          break;
        default:
          break;
      }
		}
	}
  x_basis = 'linear';
	return [trans_x, new_y];
}

function transformYLinear(x_data, y_data){ //takes in RAW DATA for x and y, always
	var trans_y = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
  var new_x = [];

	for (var i = 0; i < y_data.length; i++){
		if (y_data[i] > 0){
			trans_y.push(y_data[i]);
      switch (x_basis){
        case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
          new_x.push(x_data[i]);
          break;
        case 'log':
          if (x_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
            trans_y.pop();
          } else {
            new_x.push(Math.log10(x_data[i]));
          }
        case 'exp':
          new_x.push(Math.pow(10,x_data[i]));
          break;
        default:
          break;
      }
		}
	}
  y_basis = 'linear';
	return [new_x, trans_y];
}

function transformXExp(x_data, y_data){ //takes in RAW DATA for x and y, always
	var trans_x = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
  var new_y = [];

	for (var i = 0; i < x_data.length; i++){
		if (x_data[i] > 0){
			trans_x.push(Math.pow(10,x_data[i]));
      switch (y_basis){
        case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
          new_y.push(y_data[i]);
          break;
        case 'log':
          if (y_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
            trans_x.pop();
          } else {
            new_y.push(Math.log10(y_data[i]));
          }
        case 'exp':
          new_y.push(Math.pow(10,y_data[i]));
          break;
        default:
          break;
      }
		}
	}
  x_basis = 'exp';
	return [trans_x, new_y];
}

function transformYExp(x_data, y_data){ //takes in RAW DATA for x and y, always
	var trans_y = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
  var new_x = [];

	for (var i = 0; i < y_data.length; i++){
		if (y_data[i] > 0){
			trans_y.push(Math.pow(10,y_data[i]));
      switch (x_basis){
        case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
          new_x.push(x_data[i]);
          break;
        case 'log':
          if (x_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
            trans_y.pop();
          } else {
            new_x.push(Math.log10(x_data[i]));
          }
        case 'exp':
          new_x.push(Math.pow(10,x_data[i]));
          break;
        default:
          break;
      }
		}
	}
  y_basis = 'exp';
	return [new_x, trans_y];
}

function transformXLog(x_data, y_data){ //takes in RAW DATA for x and y, always
	var trans_x = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
  var new_y = [];

	for (var i = 0; i < x_data.length; i++){
		if (x_data[i] > 0){
			trans_x.push(Math.log10(x_data[i]));
      switch (y_basis){
        case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
          new_y.push(y_data[i]);
          break;
        case 'log':
          if (y_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
            trans_x.pop();
          } else {
            new_y.push(Math.log10(y_data[i]));
          }
        case 'exp':
          new_y.push(Math.pow(10,y_data[i]));
          break;
        default:
          break;
      }
		}
	}
  x_basis = 'log';
	return [trans_x, new_y];
}

function transformYLog(x_data, y_data){ //takes in RAW DATA for x and y, always
	var trans_y = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
  var new_x = [];

	for (var i = 0; i < y_data.length; i++){
		if (y_data[i] > 0){
			trans_y.push(Math.log10(y_data[i]));
      switch (x_basis){
        case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
          new_x.push(x_data[i]);
          break;
        case 'log':
          if (x_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
            trans_y.pop();
          } else {
            new_x.push(Math.log10(x_data[i]));
          }
        case 'exp':
          new_x.push(Math.pow(10,x_data[i]));
          break;
        default:
          break;
      }
		}
	}
  y_basis = 'log';
	return [new_x, trans_y];
}

function changeInputBasis(){ //returns the data modified to the correct basis; in the correct format to be sent via ajax (same as inputDataContents)
	var datapoint;
	var newInputData = "";

	var inputDataContents = document.getElementById('inputTextAreaData').value;
  var inputData_Arr_unsorted = inputDataContents.split("\n");
	var inputData_Arr = [];

	for (var i = 0; i < inputData_Arr_unsorted.length; i++){ //gets rid of blank lines
		if ((inputData_Arr_unsorted[i] != "") && (inputData_Arr_unsorted[i] != " "))
			inputData_Arr.push(inputData_Arr_unsorted[i]);
	}
	var N = inputData_Arr.length;


	var has_Weights = $('#Weighted').data('clicked');
	var has_ErrorBars = $('#ErrorBars').data('clicked');

	if (has_Weights || has_ErrorBars){
		switch(y_basis){
			case 'linear':

        for (var i = 0; i < N; i++){
          datapoint = inputData_Arr[i].split("\t");
          if (datapoint.length < 3){ //if not tab seperated, try space seperated
            datapoint = inputData_Arr[i].split(" ");
          }
          w = datapoint[2];
          if (has_ErrorBars){
            w = 1.0 / Math.pow(Number(w), 2.0);
            w = w.toString();
          }
          newInputData += datapoint[0] + " " + datapoint[1] + " " +  w + "\n";
        }
        inputDataContents = newInputData;
				break;
			case 'log':

        for (var i = 0; i < N; i++){
          datapoint = inputData_Arr[i].split("\t");
          if (datapoint.length < 3){ //if not tab seperated, try space seperated
            datapoint = inputData_Arr[i].split(" ");
          }
          w = datapoint[2];
          if (has_ErrorBars){
            w = 1.0 / Math.pow(Number(w), 2.0);
            w = w.toString();
          }
          if (Number(datapoint[1]) > 0){
            newInputData += datapoint[0] + " " + Math.log10(Number(datapoint[1])).toString() + " " +  w + "\n";
          }
        }
        inputDataContents = newInputData;
        break;
			case 'exp':

        for (var i = 0; i < N; i++){
          datapoint = inputData_Arr[i].split("\t");
          if (datapoint.length < 3){ //if not tab seperated, try space seperated
            datapoint = inputData_Arr[i].split(" ");
          }
          w = datapoint[2];
          if (has_ErrorBars){
            w = 1.0 / Math.pow(Number(w), 2.0);
            w = w.toString();
          }
          newInputData += datapoint[0] + " " + Math.pow(10, Number(datapoint[1])).toString() + " " +  w + "\n";
        }
        inputDataContents = newInputData;

				break;
			default:
				break;
		}
	} else {
		switch(y_basis){
			case 'linear':

        for (var i = 0; i < N; i++){
          datapoint = inputData_Arr[i].split("\t");
          if (datapoint.length < 2){ //if not tab seperated, try space seperated
            datapoint = inputData_Arr[i].split(" ");
          }
          newInputData += datapoint[0] + " " + datapoint[1] + "\n";
        }
        inputDataContents = newInputData;
				break;
			case 'log':

        for (var i = 0; i < N; i++){
          datapoint = inputData_Arr[i].split("\t");
          if (datapoint.length < 2){ //if not tab seperated, try space seperated
            datapoint = inputData_Arr[i].split(" ");
          }
          if (Number(datapoint[1]) > 0){
            newInputData += datapoint[0] + " " + Math.log10(Number(datapoint[1])).toString() + "\n";
          }
        }
        inputDataContents = newInputData;

				break;
			case 'exp':

        for (var i = 0; i < N; i++){
          datapoint = inputData_Arr[i].split("\t");
          if (datapoint.length < 2){ //if not tab seperated, try space seperated
            datapoint = inputData_Arr[i].split(" ");
          }
          newInputData += datapoint[0] + " " + Math.pow(10, Number(datapoint[1])).toString() + "\n";
        }
        inputDataContents = newInputData;

				break;
			default:
				break;
		}

	}

	return inputDataContents;
}

function transformExp(data){
	var y_trans = [];

	for (var i = 0; i < data.length; i++){
		y_trans.push(Math.pow(10,data[i]));
	}

	return y_trans;
}
function transformLog(data){
  let y_trans = [];
  var new_val;

	for (var i = 0; i < data.length; i++){
		if (data[i] > 0){
      new_val = Math.log10(data[i]);
    } else {
      new_val = 0
    }
    
    y_trans.push(new_val);
	}

	return y_trans;
}

function transformData(x_data, y_data){

  // console.log(`Transforming x to ${x_basis} and y to ${y_basis}.`);

  switch (x_basis){
		case "linear":
			break;
		case "log":
			x_data = transformLog(x_data);
			break;
		case "exp":
			x_data = transformExp(x_data);
		default:
			break;
  }

  switch (y_basis){
		case "linear":
			break;
		case "log":
			y_data = transformLog(y_data);
			break;
		case "exp":
			y_data = transformExp(y_data);
		default:
			break;
  }

  // console.log("New data:");
  // console.log(x_data, y_data);

  return [x_data, y_data];
}

function alertBadWeights(){
	alert("Check data:  Missing weights!");
	return;
}

function alertBadEBs(){
	alert("Check data:  Missing error bars!");
	return;
}

function getData(){
	var has_Weights = $('#Weighted').data('clicked');
	var has_ErrorBars = $('#ErrorBars').data('clicked');

  var x_data = [];
	var y_data = [];
	var w_data = [];

	var inputData = document.getElementById('inputTextAreaData').value;

  var inputData_Arr_unsorted = inputData.split("\n");
	var inputData_Arr = [];

	for (var i = 0; i < inputData_Arr_unsorted.length; i++){ //gets rid of blank lines
		if ((inputData_Arr_unsorted[i] != "") && (inputData_Arr_unsorted[i] != " "))
			inputData_Arr.push(inputData_Arr_unsorted[i]);
	}

	var N = inputData_Arr.length;

    //console.log(inputData_Arr);
	if (has_Weights || has_ErrorBars){
    for (var i = 0; i < N; i++){
    	datapoint = inputData_Arr[i].split("\t");
    	if (datapoint.length < 3){ //if not tab seperated, try space seperated
    		datapoint = inputData_Arr[i].split(" ");
    	}
      if (datapoint.length < 3){ // at this point, weight or EB must be missing
        if (has_Weights){
          alertBadWeights();
          return;
        } else {
          alertBadEBs();
          return;
        }
      }

      x_data.push(Number(datapoint[0]));
      y_data.push(Number(datapoint[1]));
      if (has_ErrorBars){
        //w_data.push(1.0 / Math.pow(Number(datapoint[1]),2.0))
        w_data.push(Number(datapoint[2])); //purpose of this function is to just get data, not modify it
      } else if (has_Weights){
        w_data.push(Number(datapoint[2]));
      }
		}
    let transData = transformData(x_data, y_data);
    x_data = transData[0];
    y_data = transData[1];

		return [x_data, y_data, w_data];
	} else {
    for (var i = 0; i < N; i++){
    	datapoint = inputData_Arr[i].split("\t");
    	if (datapoint.length < 2){ //if not tab seperated, try space seperated
    		datapoint = inputData_Arr[i].split(" ");
    	}
      x_data.push(Number(datapoint[0]));
      y_data.push(Number(datapoint[1]));
		}
		}
    let transData = transformData(x_data, y_data);
    x_data = transData[0];
    y_data = transData[1];

		return [x_data, y_data];
	}

function convertData(inputDataContents){ //convert from new format to old format
  var has_Weights = $('#Weighted').data('clicked');
	var has_ErrorBars = $('#ErrorBars').data('clicked');

  var x_data = [];
  var y_data = []; //these are lists of strings
	var w_data = [];

  console.log("inputDataContents: " + inputDataContents);

  mainDataContents = "";
  xDataContents = "";
  var inputData_Arr_unfiltered = inputDataContents.split("\n");
	var inputData_Arr = [];

	for (var i = 0; i < inputData_Arr_unfiltered.length; i++){ //gets rid of blank lines
		if ((inputData_Arr_unfiltered[i] != "") && (inputData_Arr_unfiltered[i] != " "))
			inputData_Arr.push(inputData_Arr_unfiltered[i]);
	}
	var N = inputData_Arr.length;

  console.log("inputData_Arr: " + inputData_Arr);

  if (has_Weights || has_ErrorBars){ //creates lists of data (list of strings)
    for (var i = 0; i < N; i++){
    	datapoint = inputData_Arr[i].split("\t");
    	if (datapoint.length < 3){ //if not tab seperated, try space seperated
    		datapoint = inputData_Arr[i].split(" ");
    	}
        x_data.push(datapoint[0]);
        y_data.push(datapoint[1]);
        w_data.push(datapoint[2]);
		}
	} else {
      for (var i = 0; i < N; i++){
      	datapoint = inputData_Arr[i].split("\t");
      	if (datapoint.length < 2){ //if not tab seperated, try space seperated
      		datapoint = inputData_Arr[i].split(" ");
      	}
          x_data.push(datapoint[0]);
          y_data.push(datapoint[1]);
  		}
		}

  for (var i = 0; i < N; i++){
    xDataContents += x_data[i] + "\n";
  }

  if (has_Weights || has_ErrorBars){ //adds data to old format strings
    for (var i = 0; i < N; i++){
    	mainDataContents += y_data[i] + " " + w_data[i] + "\n";
		}
	}
  else {
    for (var i = 0; i < N; i++){
    	mainDataContents += y_data[i] + "\n";
		}
	}

  console.log(xDataContents);
  console.log(mainDataContents);

  return [mainDataContents, xDataContents];
}

function functionSelector(functionName){
  chosenFunctionType = functionName;
  console.log('Function chosen: ' + chosenFunctionType)
}
/*
function getBar(xArr, fType, params, wArr = []){ //gets custom "bar" function, ie xBar, logxBar, etc depending on model
  if (wArr === []){ //if equal weights
    for (var i = 0; i < xArr.length; i++){
      wArr.push(1.0);
    }
  }

  var lowerSum = 0;
  var upperSum = 0;
  for (var i = 0; i < xArr.length; i++){
  switch (fType){
    case 'PowerLaw':
    for (var i = 0; i < xArr.length; i++){
      double y_i = f(xArr[i], params);
  		uppersum += wArr[i] * Math.log10(xArr[i]) * Math.pow(y_i, 2.0);
  		lowersum += wArr[i] * Math.pow(10.0, -2.0*y_i);
    }
    break;

    case 'Exponential':
    case 'Logarithmic':
    default:
      for (var i = 0; i < xArr.length; i++){
        uppersum += (xArr[i] * wArr[i]);
        lowersum += w[i];
      }
      break;
  }
  return (upperSum / lowerSum);
}
*/
function displayChosenFunction(t){
  document.getElementById("SelectedFunction").innerHTML = t.innerHTML;
  return;
}
/*
function displayBar(){
  var has_Weights = $('#Weighted').data('clicked');
	var has_ErrorBars = $('#ErrorBars').data('clicked');
  var res = getData();

  var x = res[0];
  var xBar;

  if (has_Weights){
    var w = res[2];
    xBar = getWeightedXBar(x, w);
    document.getElementById("XBarDisplay").innerHTML = String(Math.round(xBar * 1000) / 1000);

  } else if (has_ErrorBars){
    var w = res[2].map(x => 1.0/Math.pow(x, 2.0));
    xBar = getWeightedXBar(x, w);
    document.getElementById("XBarDisplay").innerHTML = String(Math.round(xBar * 1000) / 1000);
  } else  {
    xBar = getXBar(x);
    document.getElementById("XBarDisplay").innerHTML = String(Math.round(xBar * 1000) / 1000);
  }
  return;
}

function displayLogBar(){

}
*/
function displayBar(t){
  var chosenFn = t.id;
  switch (chosenFn){
    case "PowerLaw":
      document.getElementById("XBarDisplay").innerHTML = "<span style=\"text-decoration:overline\">log x</span> = Σ<sub>i</sub>w<sub>i</sub>(log x<sub>i</sub>)y<sup>2</sup>(x<sub>i</sub>) / Σ<sub>i</sub>w<sub>i</sub>y<sup>2</sup>(x<sub>i</sub>)";
      document.getElementById("xBarType").innerHTML = "log x";
      document.getElementById("xBarInp").innerHTML = "log x";
      document.getElementById("xBarOut").innerHTML = "log x";
      break;
    case "Exponential":
      document.getElementById("XBarDisplay").innerHTML = "<span style=\"text-decoration:overline\">x</span> = Σ<sub>i</sub>w<sub>i</sub>x<sub>i</sub>y<sup>2</sup>(x<sub>i</sub>) / Σ<sub>i</sub>w<sub>i</sub>y<sup>2</sup>(x<sub>i</sub>)";
      document.getElementById("xBarType").innerHTML = "x";
      document.getElementById("xBarInp").innerHTML = "x";
      document.getElementById("xBarOut").innerHTML = "x";
      break;
    case "Logarithmic":
      document.getElementById("XBarDisplay").innerHTML = "<span style=\"text-decoration:overline\">log x</span> = Σ<sub>i</sub>w<sub>i</sub>(log x<sub>i</sub>)10<sup>-2y(x<sub>i</sub>)</sup> / Σ<sub>i</sub>w<sub>i</sub>10<sup>-2y(x<sub>i</sub>)</sup>";
      document.getElementById("xBarType").innerHTML = "log x";
      document.getElementById("xBarInp").innerHTML = "log x";
      document.getElementById("xBarOut").innerHTML = "log x";
      break;
    default:
      document.getElementById("XBarDisplay").innerHTML = "<span style=\"text-decoration:overline\">x</span> = Σ<sub>i</sub>w<sub>i</sub>x<sub>i</sub> / Σ<sub>i</sub>w<sub>i</sub>";
      document.getElementById("xBarType").innerHTML = "x";
      document.getElementById("xBarInp").innerHTML = "x";
      document.getElementById("xBarOut").innerHTML = "x";
      break;
  }
  return;
}

function createBasisNotice(){
  switch(y_basis){
    case 'linear':
      $('#BasisNotice').css('display','none');
      break;
    case 'log':
      document.getElementById("BasisNotice").innerHTML = "Notice: All results shown below are in the chosen logarithmic basis for y(x)."
      $('#BasisNotice').css('display','block');
      break;
    case 'exp':
      document.getElementById("BasisNotice").innerHTML = "Notice: All results shown below are in the chosen exponential basis for y(x)."
      $('#BasisNotice').css('display','block');
      break;
    default:
      break;
  }
}

function overRejPercentage(N){
 		//N is data size/ number of data points
		var percentageArray = [46.435,65.717,65.717,0.127,
													25.547,48.491,48.491,0.039,
													25.442,29.97,32.381,0.014,
													14.362,20.828,24.589,0.007,
													10.112,14.305,19.601,0.002,
													7.554,9.961,15.853,0.003,
													5.941,7.138,13.151,0.003,
													4.155,5.06,10.952,0,
													3.576,3.702,9.448,0,
													2.694,2.665,7.915,0,
													2.199,2.063,6.912,0,
													1.736,1.506,5.813,0,
													1.405,1.17,5.061,0,
													1.161,0.945,4.377,0,
													1.039,0.719,3.802,0,
													0.867,0.53,3.282,0,
													0.726,0.468,2.961,0,
													0.657,0.346,2.573,0,
													0.597,0.304,2.326,0,
													0.495,0.239,2.037,0,
													0.416,0.183,1.856,0,
													0.365,0.168,1.642,0,
													0.289,0.126,1.51,0,
													0.277,0.109,1.347,0,
													0.256,0.091,1.22,0,
													0.251,0.075,1.149,0,
													0.21,0.056,1.023,0,
													0.209,0.044,0.918,0,
													0.189,0.043,0.874,0,
													0.178,0.033,0.811,0,
													0.17,0.024,0.722,0,
													0.153,0.024,0.649,0,
													0.132,0.014,0.592,0,
													0.113,0.021,0.566,0,
													0.1,0.018,0.537,0,
													0.09,0.014,0.479,0,
													0.083,0.021,0.451,0,
													0.075,0.013,0.418,0,
													0.074,0.013,0.418,0,
													0.067,0.007,0.375,0,
													0.054,0.009,0.365,0,
													0.047,0.006,0.323,0,
													0.045,0.004,0.314,0,
													0.044,0.004,0.287,0,
													0.045,0.002,0.286,0,
													0.037,0.003,0.251,0,
													0.028,0,0.223,0,
													0.026,0.004,0.221,0,
													0.021,0.003,0.221,0,
													0.025,0.003,0.224,0,
													0.021,0.001,0.201,0,
													0.019,0.001,0.189,0,
													0.016,0.001,0.18,0,
													0.017,0.003,0.176,0,
													0.014,0.003,0.162,0,
													0.014,0.002,0.145,0,
													0.013,0.003,0.137,0,
													0.012,0.004,0.132,0,
													0.008,0.002,0.122,0,
													0.009,0.002,0.105,0,
													0.011,0.001,0.103,0,
													0.01,0.001,0.095,0,
													0.009,0.002,0.086,0,
													0.008,0.003,0.086,0,
													0.011,0.001,0.085,0,
													0.013,0.002,0.088,0,
													0.011,0.001,0.08,0,
													0.007,0.001,0.086,0,
													0.004,0,0.078,0,
													0.005,0,0.075,0,
													0.007,0,0.074,0,
													0.004,0.002,0.06,0,
													0.005,0,0.062,0,
													0.008,0,0.063,0,
													0.008,0.002,0.06,4,0,
													0.008,0.001,0.057,0,
													0.006,0.001,0.062,0,
													0.006,0.001,0.055,0,
													0.008,0,0.053,0,
													0.005,0,0.05,0,
													0.005,0.001,0.048,0,
													0.004,0,0.046,0,
													0.005,0,0.049,0,
													0.005,0,0.045,0,
													0.004,0,0.043,0,
													0.005,0,0.039,0,
													0.004,0,0.036,0,
													0.004,0,0.042,0,
													0.004,0.001,0.042,0,
													0.003,0,0.034,0,
													0.004,0,0.037,0,
													0.004,0,0.035,0,
													0.003,0,0.028,0,
													0.003,0,0.028,0,
													0.002,0,0.029,0,
													0.002,0,0.027,0,
													0.002,0,0.027,0];

		var percentage2DArr = []; //converts the percentage data to a 2d array
  	for (var i = 0; i < 97; i++){
  		percentage2DArr.push(percentageArray.slice(0 + 4*i, 4 + 4*i));
  	}

		var hasSymm = $('#Symmetric').data('clicked');
    var hasEq = $('#Equal').data('clicked');
    var hasOne = $('#OneSided').data('clicked');
    var hasInBet = $('#Between').data('clicked');

		var rej; //rej corresponds to the number of the column of rcr_overrejectionprecentages.csv

		if (hasSymm){
			if (hasEq){
				rej = 0; //'ss_med_dl'
			} else if (hasOne){
				rej = 1;
			} else if (hasInBet){
				rej = 2;
			}
		} else {
			rej = 3;
		}

		var percentage = Math.round( percentage2DArr[N-3][rej] * 10) / 10;
		//rounds to first decimal place
		return percentage;
}

function createOverRejectionNotice(){
  var N = (getData()[0]).length;

  if (N < 3){
    document.getElementById("OverRejectionNotice").innerHTML = "Note: Please enter at least three, properly formatted data points.";
    $('#OutputTableWrapper').css('display','none');
    $('#OverRejectionNote').css('display','block');
    return true;
  }

  if (N >= 3 && N <= 99){
    var perc = overRejPercentage(N);
    if (perc < 0.1){
      document.getElementById("OverRejectionNotice").innerHTML = "Note: Chance of runaway overrejection is <0.1%."
    } else if (perc >= 0.1){
    document.getElementById("OverRejectionNotice").innerHTML = "Note: Chance of runaway overrejection is " + perc.toString() +"%.";
    }
  } else if (N > 99){
    document.getElementById("OverRejectionNotice").innerHTML = "Note: Chance of runaway overrejection is <0.1%.";
  }
  $('#OverRejectionNote').css('display','block');

  return;
}

function showPriorsBox(show){
  if (show){
    $('#priorsBox').css('display','inline');
    $('#priorsInput').css('display','inline');
  }
  else {
    $('#priorsBox').css('display','none');
    $('#priorsInput').css('display','none');
  }
}

function linspace(start, stop, size){
  let x = []
  let delta = (stop - start) / size;

  for (let i = 0; i < size; i++){
    x.push(start + i*delta);
  }

  x = x.filter(y => y <= stop);
  return x;
}

function makeXPlotData(xDataContents){
  let x_data = xDataContents.split("\n");
  console.log(x_data);
  let x_data_new = [];
  for (let i = 0; i < x_data.length; i++){
    if (x_data[i] !== ""){
      x_data_new.push(x_data[i]);
    }
  }
  x_data = x_data_new

  console.log(x_data);
  x_data = x_data.map(Number);

  console.log(x_data);

  let xmax = Math.max(...x_data)
  let xmin = Math.min(...x_data)
  x_data_range = Math.abs(xmax - xmin)

  x_original_result = linspace(xmin - x_data_range/2, xmax + x_data_range/2, 1000);
  console.log(xDataContents);
  console.log(x_original_result);
  return;
}

function checkGuessFormat(guessDataContents){
  let t = false;

  let single_line = guessDataContents.split("\n")[0]
  let single_line_arr_1 = single_line.split(" ")
  let single_line_arr_2 = single_line.split("\t")

  if (single_line_arr_1.length > 1 || single_line_arr_2.length > 1){
    t = true;
  }

  return t;
}

function performFunctionalRCR(){

  createBasisNotice();
  hide = createOverRejectionNotice();
  if (hide){
    return;
  }

  x_rejected_result = [];
  y_rejected_result = [];
  x_nonrejected_result = [];
  y_nonrejected_result = [];
  x_original_result = [];
  y_fitted_result = [];

  var inputDataContents = changeInputBasis(); //either doesn't change the data, or changes it to fit correct basis (only changes y, not w/errors)

  var convertedData = convertData(inputDataContents); //also converts error bars to weights

  mainDataContents = convertedData[0];
  xDataContents = convertedData[1];

  //for plotting the fitted function: (completes x_original_result)
  makeXPlotData(xDataContents);


  //mainDataContents = document.getElementById('ydataarea').value
  //xDataContents = document.getElementById('xdataarea').value
  guessDataContents = document.getElementById('guessarea').value
  barDataContents = document.getElementById('barArea').value
  priorsDataContents = document.getElementById('priorsArea').value


  if (checkGuessFormat(guessDataContents)){
    alert("Check guess data:  Needs to have only one value per line!");
    return;
  }

  $('#OutputTableWrapper').css('display', 'inline');
  $('#Plot').css('display', 'inline');

  hasSymmetricDist = $('#Symmetric').data('clicked');
  hasEqualCont = $('#Equal').data('clicked');
  hasOneSidedCont = $('#OneSided').data('clicked');
  hasInBetweenCont = $('#Between').data('clicked');
  hasWeights = $('#Weighted').data('clicked');
  if (hasWeights === false){
      hasWeights = $('#ErrorBars').data('clicked');
  }
  hasPriors = $('#YesPriors').data('clicked');



  console.log("mainDataContents:" + mainDataContents);
  console.log("xDataContents:" + xDataContents);
  console.log("guessDataContents:" + guessDataContents);
  console.log("hasSymmetricDist: " + hasSymmetricDist);
	console.log("hasEqualCont: " + hasEqualCont);
	console.log("hasOneSidedCont: " + hasOneSidedCont);
	console.log("hasInBetweenCont: " + hasInBetweenCont);
	console.log("hasWeights: " + hasWeights);
  console.log("chosenFunctionType: " + chosenFunctionType);
  console.log("hasPriors: " + hasPriors);
  //console.log(correct_barData);

  //Rejection tech determination:
  var rejTechInt = "0"

  if (hasSymmetricDist){
      if (hasEqualCont){
          rejTechInt = "1"
        }
      else if (hasOneSidedCont){
          rejTechInt = "2"
        }
      else if (hasInBetweenCont){
          rejTechInt = "3"
        }
      }
  else{
      rejTechInt = "4"
    }

  console.log("Rejection Type Int: " + rejTechInt);

  var request = $.ajax
      (
          {
              url: '/rcr/calculator/callFunctionalRCR',
              type: "POST",
              data: { mainData : mainDataContents,
                      xData : xDataContents,
                      guessData : guessDataContents,
                      rejectionType : rejTechInt,
                      weighted :  hasWeights,
                      functionType : chosenFunctionType,
                      barData : barDataContents,
                      priorsData : priorsDataContents,
                      priorsCheck : hasPriors


                    },
              dataType: "json",
              success: function(data, textStatus, jqXHR)
              {
                  console.log('yes');
      console.log(data);
                  document.getElementById('finalParameters').value = data['finalParametersData'].split("\n").slice(0, -1).join("\n") + "\n\n" + data['finalParametersData'].split("\n").slice(-1)[0];
                  document.getElementById('nonRejectedData').value = data['nonRejectedData'];
                  document.getElementById('rejectedData').value = data['rejectedData'];
                  document.getElementById('allData').value = data['allData'];

                  //convert results to lists of strings (for plotting)
                  var parameters_result = data['finalParametersData'].split("\n");
                  parameters_result = parameters_result.map(Number);

                  var bar_result = parameters_result[parameters_result.length - 1];

                  var nonRejArr = data['nonRejectedData'].split("\n");
                  var rejArr = data['rejectedData'].split("\n");

                  //adds number data to nonrejected and rejected x and y arrays
                  for (var i = 0; i < nonRejArr.length; i++) {
                    var dataSet = nonRejArr[i].split("\t");
                    if (dataSet.length < 2){ //if not tab seperated, try space seperated
                      dataSet = nonRejArr[i].split(" ");
                    }
                    x_nonrejected_result.push(Number(dataSet[0]));
                    y_nonrejected_result.push(Number(dataSet[1]));
                  }
                  for (var i = 0; i < rejArr.length; i++) {
                    var dataSet = rejArr[i].split("\t");
                    if (dataSet.length < 2){ //if not tab seperated, try space seperated
                      dataSet = rejArr[i].split(" ");
                    }
                    x_rejected_result.push(Number(dataSet[0]));
                    y_rejected_result.push(Number(dataSet[1]));

                  }
                  //for plotting the fitted function: (completes x_original_result)
                  //x_original_result = makeXPlotData(xDataContents);

                  // gets array of weights, as numbers in order:
                  // var weights_result = [];
                  // if (hasWeights){
                  //   var mainDataContents_arr = mainDataContents.split("\n");

                  //   for (var i = 0; i < x_original_result.length; i++){
                  //     var dataSet = mainDataContents_arr[i].split("\t");
                  //     if (dataSet.length < 2){ //if not tab seperated, try space seperated
                  //       dataSet = mainDataContents_arr[i].split(" ");
                  //     }
                  //     weights_result.push(Number(dataSet[2]));
                  //   }
                  // }


                  //creates data for fitted model (y_fitted_result)
                  switch (chosenFunctionType){
                    case "Linear":

                      var a0 = parameters_result[0];
                      var a1 = parameters_result[1];

                      console.log(a0, a1, bar_result);

                      for (var i = 0; i < x_original_result.length; i++) {
                        var y_point = ( a0 + a1*(x_original_result[i] - bar_result) )
                        y_fitted_result.push(y_point)
                      }
                      break;
                    case "Quadratic":

                      var a0 = parameters_result[0];
                      var a1 = parameters_result[1];
                      var a2 = parameters_result[2];

                      for (var i = 0; i < x_original_result.length; i++) {
                        var y_point = ( a0 + a1*(x_original_result[i] - bar_result) + a2*Math.pow((x_original_result[i] - bar_result), 2.0))
                        y_fitted_result.push(y_point)
                      }
                      break;
                    case "Cubic":

                      var a0 = parameters_result[0];
                      var a1 = parameters_result[1];
                      var a2 = parameters_result[2];
                      var a3 = parameters_result[3];

                      for (var i = 0; i < x_original_result.length; i++) {
                        var y_point = ( a0 + a1*(x_original_result[i] - bar_result) + a2*Math.pow((x_original_result[i] - bar_result), 2.0) + a3*Math.pow((x_original_result[i] - bar_result), 3.0))
                        y_fitted_result.push(y_point)
                      }
                      break;
                    case "PowerLaw":

                      var a0 = parameters_result[0];
                      var a1 = parameters_result[1];

                      for (var i = 0; i < x_original_result.length; i++) {
                        var y_point = ( a0*Math.pow((x_original_result[i]/Math.pow(10, bar_result)), a1) )
                        y_fitted_result.push(y_point)
                      }
                      break;
                    case "Exponential":

                      var a0 = parameters_result[0];
                      var a1 = parameters_result[1];

                      for (var i = 0; i < x_original_result.length; i++) {
                        var y_point = ( a0 * Math.pow(10, a1*(x_original_result[i]-bar_result)) )
                        y_fitted_result.push(y_point)
                      }
                      break;
                    case "Logarithmic":

                      var a0 = parameters_result[0];

                      for (var i = 0; i < x_original_result.length; i++) {
                        var y_point = ( a0 * Math.log10(x_original_result[i] - bar_result) )
                        y_fitted_result.push(y_point)
                      }
                      break;
                    default:
                      console.log("Error: no model function selected");
                      break;
                    }

                    // console.log(y_fitted_result)




                  //console.log(data['rejTech']);


              },
              error: function (jqXHR, textStatus, errorThrown)
              {
                  console.log(errorThrown)
                  console.log('no');
                  console.log(jqXHR);
                  console.log(textStatus);
              }
          }
      );



  //this function will use a different parametric function, and corresponding c++ function based off of what parametric function was chosen
  }

function type(){
        $('#priorsBox').css('display','none');
        $('#priorsInput').css('display','none');
        $('#RCRNote').css('display','block');
        $('#NonRCRNote').css('display','none');
        $('#BasisNotice').css('display','none');
        $('#SelectContaminantSection').css('display','block');
        $('#OutputTableWrapper').css('display','inline');
        $('#LinearImage').css('display', 'none');
				$('#QuadraticImage').css('display', 'none');
				$('#CubicImage').css('display', 'none');
        $('#PowerLawImage').css('display', 'none');
				$('#ExponentialImage').css('display', 'none');
				$('#LogarithmicImage').css('display', 'none');
        $('#functionImage').css('display', 'none');
        $('#SymmetricImage').css('display', 'none');
        $('#AsymmetricImage').css('display', 'none');
        $('#Plot').css('display', 'none');
      	document.getElementById("SelectContaminantSectionTitle").innerHTML = "Select Contaminant Type:";
      	document.getElementById("PerformRCR").innerHTML = "Perform RCR!";
        $('#OutputTableWrapper').css('display','none');
        document.getElementById('nonRejectedData').value = '';
        document.getElementById('rejectedData').value = '';
        document.getElementById('allData').value = '';
        switch (true)
		{
            case ($('#Symmetric').data('clicked') && $('#Equal').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option11').css('display','block');
				$('#OptionAll').css('display','block');
        $('#SymmetricImage').css('display', 'block');
                break;
			case ($('#Symmetric').data('clicked') &&  $('#OneSided').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option12').css('display','block');
				$('#OptionAll').css('display','block');
        $('#SymmetricImage').css('display', 'block');
                break;
			case ($('#Symmetric').data('clicked') && $('#Between').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option13').css('display','block');
				$('#OptionAll').css('display','block');
        $('#SymmetricImage').css('display', 'block');
                break;
			case ($('#Asymmetric').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option2All').css('display','block');
				$('#OptionAll').css('display','block');
        $('#AsymmetricImage').css('display', 'block');
                break;

      case ($('#Linear').data('clicked')):
        $('#LinearImage').css('display', 'block');
                break;
      case ($('#Quadratic').data('clicked')):
        $('#QuadraticImage').css('display', 'block');
                break;
      case ($('#Cubic').data('clicked')):
        $('#CubicImage').css('display', 'block');
                break;
      case ($('#PowerLaw').data('clicked')):
        $('#PowerLawImage').css('display', 'block');
                break;
      case ($('#Exponential').data('clicked')):
        $('#ExponentialImage').css('display', 'block');
                break;
      case ($('#Logarithmic').data('clicked')):
        $('#LogarithmicImage').css('display', 'block');
                break;


      /*
			case ($('#Nongaussian').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option3').css('display','block');
				$('#Option3Image').css('display', 'block');

                $('#RCRNote').css('display','none');
                $('#SelectContaminantSection').css('display','none');
        	$('#OutputTableWrapper').css('display','none');
      */

		document.getElementById("SelectContaminantSectionTitle").innerHTML = "We do not perform outlier rejection in this case.";
		document.getElementById("PerformRCR").innerHTML = "Characterize!";

                $('#NonRCRNote').css('display','block');

                break;
			default:
				$('.RejectionMethods').css('display','none')

        };
};
function outputSelection(){
       switch (true)
		{
            case ($('#showNonRejected').data('clicked')):
				$('#nonRejectedData').css('display','inline')
				$('#rejectedData').css('display','none');
				$('#allData').css('display','none');
                break;
            case ($('#showRejected').data('clicked')):
				$('#nonRejectedData').css('display','none')
				$('#rejectedData').css('display','inline');
				$('#allData').css('display','none');
                break;
            case ($('#showAll').data('clicked')):
				$('#nonRejectedData').css('display','none')
				$('#rejectedData').css('display','none');
				$('#allData').css('display','inline');
                break;
			default:
				$('.RejectionMethods').css('display','none')

        };
}

function toggleBool(button)	{
		if ($(button).data('clicked') === false)
		{
			$(button).data('clicked',true);
			return;
		}
		else if ($(button).data('clicked') === true)
		{
			$(button).data('clicked', false);
		}
	};

function SingleActiveButtonCheck(button1, button2){
	if ($(button1).data('clicked') === true && $(button2).data('clicked') === true)
	{
		toggleBool($(button2))
		$(button2).toggleClass('ButtonActive');
	}
};

function SingleActiveButtonCheckNoBool(button1, button2){
	if ($(button1).hasClass('ButtonActive')&& $(button2).hasClass('ButtonActive'))
	{
    //console.log(chosenFunctionType);
		$(button2).toggleClass('ButtonActive');
	}
};

function main(){

	$('#Symmetric').data('clicked',true);
	$('#Asymmetric').data('clicked',false);
	//$('#Nongaussian').data('clicked',false);

	$('#Equal').data('clicked',false);
	$('#Between').data('clicked',true);
	$('#OneSided').data('clicked',false);

	$('#Unweighted').data('clicked', true);
	$('#Weighted').data('clicked',false);
  $('#ErrorBars').data('clicked',false);

  $('#NoPriors').data('clicked', true);
	$('#YesPriors').data('clicked',false);

  $('#showNonRejected').data('clicked',true);
	$('#showRejected').data('clicked',false);
	$('#showAll').data('clicked',false);

  $('#Linear').data('clicked',true);

	$('#showNonRejected').toggleClass('ButtonActive');
	$('#Symmetric').toggleClass('ButtonActive');
	$('#Between').toggleClass('ButtonActive');
	$('#Unweighted').toggleClass("ButtonActive");
  $('#NoPriors').toggleClass('ButtonActive');



	type();
    outputSelection();

    //the below are handlers for when buttons are clicked

    $('#Symmetric').click(function() {
        if ($('#Symmetric').data('clicked') === false)
        {
            toggleBool('#Symmetric');
            $('#Symmetric').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Symmetric','#Asymmetric');
            //SingleActiveButtonCheck('#Symmetric','#Nongaussian');
            type();
        }
	});
    $('#Asymmetric').click(function() {
        if ($('#Asymmetric').data('clicked') === false)
        {
            toggleBool('#Asymmetric');
            $('#Asymmetric').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Asymmetric','#Symmetric');
            //SingleActiveButtonCheck('#Asymmetric','#Nongaussian');
            type();
        }
    });
    /*
    $('#Nongaussian').click(function() {
        if ($('#Nongaussian').data('clicked') === false)
        {
            toggleBool('#Nongaussian');
            $('#Nongaussian').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Nongaussian','#Symmetric');
            SingleActiveButtonCheck('#Nongaussian','#Asymmetric');
            type();
        }
    });
    */
    $('#Equal').click(function() {
        if ($('#Equal').data('clicked') === false)
        {
            toggleBool('#Equal');
            $('#Equal').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Equal','#OneSided');
            SingleActiveButtonCheck('#Equal','#Between');
            type();
        }
    });
    $('#OneSided').click(function() {
        if ($('#OneSided').data('clicked') === false)
        {
            toggleBool('#OneSided');
            $('#OneSided').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#OneSided','#Between');
            SingleActiveButtonCheck('#OneSided','#Equal');
            type();
        }
    });
    $('#Between').click(function() {
        if ($('#Between').data('clicked') === false)
        {
            toggleBool('#Between');
            $('#Between').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Between','#Equal');
            SingleActiveButtonCheck('#Between','#OneSided');
            type();
        }
    });

    $('#showNonRejected').click(function() {
        if ($('#showNonRejected').data('clicked') === false)
        {
            toggleBool('#showNonRejected');
            $('#showNonRejected').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#showNonRejected','#showRejected');
            SingleActiveButtonCheck('#showNonRejected','#showAll');
            outputSelection();
        }
    });

    $('#showRejected').click(function() {
        if ($('#showRejected').data('clicked') === false)
        {
            toggleBool('#showRejected');
            $('#showRejected').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#showRejected','#showNonRejected');
            SingleActiveButtonCheck('#showRejected','#showAll');
            outputSelection();
        }
    });

    $('#showAll').click(function() {
        if ($('#showAll').data('clicked') === false)
        {
            toggleBool('#showAll');
            $('#showAll').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#showAll','#showNonRejected');
            SingleActiveButtonCheck('#showAll','#showRejected');
            outputSelection();
        }
    });

    $('#Unweighted').click(function()	{
          if ($('#Unweighted').data('clicked') === false)
          {
              $('#Unweighted').toggleClass("ButtonActive");
              toggleBool('#Unweighted');
              SingleActiveButtonCheck('#Unweighted','#Weighted');
  						SingleActiveButtonCheck('#Unweighted','#ErrorBars');
          }
  	});
  	$('#Weighted').click(function()	{
          if ($('#Weighted').data('clicked') === false)
          {
              $('#Weighted').toggleClass("ButtonActive");
              toggleBool('#Weighted');
              SingleActiveButtonCheck('#Weighted','#Unweighted');
  						SingleActiveButtonCheck('#Weighted','#ErrorBars');
          }
  	});

    $('#ErrorBars').click(function()	{
          if ($('#ErrorBars').data('clicked') === false)
          {
              $('#ErrorBars').toggleClass("ButtonActive");
              toggleBool('#ErrorBars');
              SingleActiveButtonCheck('#ErrorBars','#Unweighted');
  						SingleActiveButtonCheck('#ErrorBars','#Weighted');
          }
  	});
    $('#NoPriors').click(function()	{
          if ($('#NoPriors').data('clicked') === false)
          {
              $('#NoPriors').toggleClass("ButtonActive");
              toggleBool('#NoPriors');
              SingleActiveButtonCheck('#NoPriors','#YesPriors');
          }
  	});
    $('#YesPriors').click(function()	{
          if ($('#YesPriors').data('clicked') === false)
          {
              $('#YesPriors').toggleClass("ButtonActive");
              toggleBool('#YesPriors');
              SingleActiveButtonCheck('#YesPriors','#NoPriors');
          }
  	});


  $('#Linear').click(function()	{
        functionSelector('Linear');
        $('#Linear').toggleClass("ButtonActive");
        //console.log('hey')
        SingleActiveButtonCheckNoBool('#Linear','#Quadratic');
        SingleActiveButtonCheckNoBool('#Linear','#Cubic');
        SingleActiveButtonCheckNoBool('#Linear','#PowerLaw');
        SingleActiveButtonCheckNoBool('#Linear','#Exponential');
        SingleActiveButtonCheckNoBool('#Linear','#Logarithmic');

        $('#functionImage').css('display', 'inline');

        $('#LinearImage').css('display', 'inline');
				$('#QuadraticImage').css('display', 'none');
				$('#CubicImage').css('display', 'none');
        $('#PowerLawImage').css('display', 'none');
				$('#ExponentialImage').css('display', 'none');
				$('#LogarithmicImage').css('display', 'none');
	});

  $('#Quadratic').click(function()	{
        functionSelector('Quadratic');
        $('#Quadratic').toggleClass("ButtonActive");
        SingleActiveButtonCheckNoBool('#Quadratic','#Linear');
        SingleActiveButtonCheckNoBool('#Quadratic','#Cubic');
        SingleActiveButtonCheckNoBool('#Quadratic','#PowerLaw');
        SingleActiveButtonCheckNoBool('#Quadratic','#Exponential');
        SingleActiveButtonCheckNoBool('#Quadratic','#Logarithmic');

        $('#functionImage').css('display', 'inline');

        $('#LinearImage').css('display', 'none');
				$('#QuadraticImage').css('display', 'inline');
				$('#CubicImage').css('display', 'none');
        $('#PowerLawImage').css('display', 'none');
				$('#ExponentialImage').css('display', 'none');
				$('#LogarithmicImage').css('display', 'none');
	});

  $('#Cubic').click(function()	{
        functionSelector('Cubic');
        $('#Cubic').toggleClass("ButtonActive");
        SingleActiveButtonCheckNoBool('#Cubic','#Linear');
        SingleActiveButtonCheckNoBool('#Cubic','#Quadratic');
        SingleActiveButtonCheckNoBool('#Cubic','#PowerLaw');
        SingleActiveButtonCheckNoBool('#Cubic','#Exponential');
        SingleActiveButtonCheckNoBool('#Cubic','#Logarithmic');

        $('#functionImage').css('display', 'inline');

        $('#LinearImage').css('display', 'none');
				$('#QuadraticImage').css('display', 'none');
				$('#CubicImage').css('display', 'inline');
        $('#PowerLawImage').css('display', 'none');
				$('#ExponentialImage').css('display', 'none');
				$('#LogarithmicImage').css('display', 'none');
	});

  $('#PowerLaw').click(function()	{
        functionSelector('PowerLaw');
        $('#PowerLaw').toggleClass("ButtonActive");
        SingleActiveButtonCheckNoBool('#PowerLaw','#Linear');
        SingleActiveButtonCheckNoBool('#PowerLaw','#Quadratic');
        SingleActiveButtonCheckNoBool('#PowerLaw','#Cubic');
        SingleActiveButtonCheckNoBool('#PowerLaw','#Exponential');
        SingleActiveButtonCheckNoBool('#PowerLaw','#Logarithmic');

        $('#functionImage').css('display', 'inline');

        $('#LinearImage').css('display', 'none');
				$('#QuadraticImage').css('display', 'none');
				$('#CubicImage').css('display', 'none');
        $('#PowerLawImage').css('display', 'inline');
				$('#ExponentialImage').css('display', 'none');
				$('#LogarithmicImage').css('display', 'none');
	});

  $('#Exponential').click(function()	{
        functionSelector('Exponential');
        $('#Exponential').toggleClass("ButtonActive");
        SingleActiveButtonCheckNoBool('#Exponential','#Linear');
        SingleActiveButtonCheckNoBool('#Exponential','#Quadratic');
        SingleActiveButtonCheckNoBool('#Exponential','#Cubic');
        SingleActiveButtonCheckNoBool('#Exponential','#PowerLaw');
        SingleActiveButtonCheckNoBool('#Exponential','#Logarithmic');

        $('#functionImage').css('display', 'inline');

        $('#LinearImage').css('display', 'none');
				$('#QuadraticImage').css('display', 'none');
				$('#CubicImage').css('display', 'none');
        $('#PowerLawImage').css('display', 'none');
				$('#ExponentialImage').css('display', 'inline');
				$('#LogarithmicImage').css('display', 'none');
  });

  $('#Logarithmic').click(function()	{
        functionSelector('Logarithmic');
        $('#Logarithmic').toggleClass("ButtonActive");
        SingleActiveButtonCheckNoBool('#Logarithmic','#Linear');
        SingleActiveButtonCheckNoBool('#Logarithmic','#Quadratic');
        SingleActiveButtonCheckNoBool('#Logarithmic','#Cubic');
        SingleActiveButtonCheckNoBool('#Logarithmic','#PowerLaw');
        SingleActiveButtonCheckNoBool('#Logarithmic','#Exponential');

        $('#functionImage').css('display', 'inline');

        $('#LinearImage').css('display', 'none');
				$('#QuadraticImage').css('display', 'none');
				$('#CubicImage').css('display', 'none');
        $('#PowerLawImage').css('display', 'none');
				$('#ExponentialImage').css('display', 'none');
				$('#LogarithmicImage').css('display', 'inline');
  });



	var oldVal = "";
    $("#inputTextAreaData").on("change keyup paste", function()
    {
        var currentVal = $(this).val();
        if(currentVal == oldVal)
        {
            return; //check to prevent multiple simultaneous triggers
        }

        oldVal = currentVal;
        //action to be performed on textarea changed
        type();
    });

};

$(document).ready(main);

</script>